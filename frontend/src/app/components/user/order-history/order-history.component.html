<div class="history-wrapper page-wrapper">
  <div class="card history-card">
    <header class="history-header">
      <div>
        <p class="eyebrow">Pedidos anteriores</p>
        <h2>Historial de pedidos</h2>
      </div>
      <button class="btn-secondary" type="button" (click)="goBackToMenu()">Volver al menú</button>
    </header>

    <div *ngIf="loading" class="alert-info">Cargando...</div>
    <div *ngIf="!loading && errorMsg" class="alert-error">{{ errorMsg }}</div>

    <div *ngIf="!loading && !errorMsg && history?.length" class="table-wrapper">
      <table class="history-table">
        <thead>
          <tr>
            <th>Código</th>
            <th>Fecha</th>
            <th>Hora de recogida</th>
            <th>Producto</th>
            <th>Estado</th>
            <th class="text-right">Total (€)</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let o of history">
            <td>
              <ng-container *ngIf="shouldShowCode(o); else codeHidden">
                {{ codeOf(o) || '—' }}
              </ng-container>
              <ng-template #codeHidden>
                <span class="code-hidden">—</span>
              </ng-template>
            </td>
            <td>{{ o.fecha_hora || '—' }}</td>
            <td>{{ o.hora_recogida || '—' }}</td>
            <td>{{ o.producto || '—' }}</td>
            <td>
              <span class="badge" [ngClass]="stateClass(o)">{{ stateLabel(o) }}</span>
            </td>
            <td class="text-right">{{ (o.total ?? 0) | number:'1.2-2' }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="!loading && !errorMsg && !history?.length" class="empty">No tienes pedidos todavía.</div>
  </div>
</div>
